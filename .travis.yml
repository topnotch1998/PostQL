sudo: required
services:
- docker
before_install:
- docker build -t postql/tests -f ./server/Dockerfile.dev ./server
script:
- docker run -e CI=true -e USER_DATABASE -e LOGS_DATABASE -e JWT_SECRET  postql/tests
  npm run test
after_success:
- docker build -t postql/client ./client
- docker build -t postql/server ./server
- docker build -t postql/nginx ./nginx
- echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_ID" --password-stdin
- docker push postql/client
- docker push postql/server
- docker push postql/nginx
env:
  global:
  - secure: aWhn7hCNFnrqeWR5MUfFtENr2V13D4mVK9PRjlrse7n52L6MjjYU7zSl6SInDVyDBHizszqJZNwyJeTe2Gy+MWBi2YWEMvZz23L3YaDFETFztYy+1Cqi8xJuCU7FnmBpNCS0FwBgii7Ug7wlcBRNZQ8OhunirEDGdSzyevMZ8GrNwhJCfcr+kbl7p8A55r+XuU9pzlmHIWtNso+uEMfWpgfLO2hH6VQSCvCQgUb03Igu9PVo80Cqt4Y876Vnzw/xGu9DovtU7gPeD1eNSkH/8HuuinpwocO09dBQuHzwgl4DSJgtgHYsoCuN0RL4ISd1rTlrhqhilLBRd2eL4e9tlJZqhlo8Zz6mw7o78dtCs6ocd/aabtxju1zYlrBamrh2TAw6p9fLyqYNK3gnUfcpZlBhMxWYXaP4JdnU2IoSHudd7oO2BUp3eepk984cp1g8e9+Gh2ZYweDxF1uyeqL8jMFDYDHbYcWakL/6rL6H+VZhOSX18F21WFnGTKUll0TTw/kevEeCpN2MSp4vXXsHji9TlAtTp2V3bW+NaAlBIoxm6OwLVEam35jxgf3xUadAKNdc5qYRbDZQa0jHwOkqj2usF44FR4Ic6LbV1I6mAtaoht+iaUFgzIOkrj9C/65OYi1QbxjzKLOQNNHSc6l0hWt2MV2lrLWV3pSzvVpnrLs=
  - secure: ca+1F0lazf/s2CT2HafsHHfH+IrRG7kQy4nN5ILSOnnsHDiChxkDeNh2fHeJJIn1E1loAeTKcSIA55A+NbqHW5l4IINA1uqcNixf358aWb7enYCPLE8dELV7fcN86EE3WoIFEvdD4VBieR/OelrC/0O//ThJXBDT9II91DTJtHfRA3MsHMurqU1zwb1CSlcD1mamazs4hYYieU0/jmBROvvSK6DfTfLYl192Jq/6GQyTa5o3jdVXA+y7pwtxf34m96+EFyzHpnEzwv/thDlOluWQBbEEKSl3xTOt6vitqrdJXDd3HdgN3vjQNTTb5aSviOCWJTGsOuJC7i65eo0dKu8+bbkE2BTZzEQnHJkTRTvxBNneuKplmQFVWfLq//aa3MECQZuk5+CY3BHE0PsL3yVZe61Ggrn6MJa+ttaA118HY9ni7/9lN1GlE3Eu8OQ7m/kkwU2HbGCmKs7/JCEjtsI+kglHwGRztL5AKtbtGo6BXOlh8joD3VWKTHG4krgQfwX9JhIZ8crCMVeJiDRFlOcw60DXFRQhddDsSjejTQxoIl8C91WaJEl03Lu9tkSPsBhCiRuU6uZqlIrBOujc4opukZnizFnxF2S5Em4na8QWVhRoclpRLYQ1v28LI5Hy+gt8bWfBN37Zq8SwE66qaVxxQkbO15n8HcGyMA+tu6M=
  - secure: a2kMOv0dayKGHTt7LyJkkxIeQ13lDOFBeEARI9Z0gwdBFRCMlHkN6hljMYHEEmzEjOWxHeYAzgHKO/295Kj4Y+vbmTLyT2yelN1AxdEJAu+f2BzzHWX5dBwpbLbzDbipkvF6gPitrK6VoEDN+8h1SrXrn1u6GRF2/i97G/BQQISg8dQseEa3mj1lmVh8Pgnj7gkJLAkLuGD0jbATWtpvAoNDj5GlJbMSLt5TFFPyr+71rXG0PbkqY9H40GjsKgvmmt8vtHiM4ZFCfzuh71jQI0hhByhgWgSG2tIc1UimMh4+LRI5J9XtRb4Z27wBcQ6ixYlyaI6undLHze/zK50NjUZhPGDXudkXIDHZJgRLtI2PElJWewhszTKzgRuGVTYGriij1o1JnKErKYZKEgf7JywwsBU+QdNJY3Y6k7S35cYUrgA2j34R2vzprpb9uAUmN33wYAtffvIcRIJVZJc42W5J/wp8imT9T9975GShrdqVjWa9oqjK0AVmkFWXtIlAEz0BcdpPlykmUa2Imp1BmfNIZd/WDFBLw4fCuicO+EI9X1aZ+hEJkLwRSr8pptZB85riTEf594fJDkegidLufJ9m/gb6LzirbDQiUVLDaY4XIrYe4F/zz+YErMiHEdO5IFEvNA404Owsk8Cf0YxUs54fFSN5Lvcr6Vm4rOy/5kE=
  branches: 
  only:
  - dev
deploy:
  edge: true
  provider: elasticbeanstalk
  region: us-east-1
  app: postql
  env: Postql-env
  bucket_name: elasticbeanstalk-us-east-1-461955714824
  on:
    branch: dev
  access_key_id: "$AWS_ACCESS_KEY"
  secret_access_key: "$AWS_SECRET_KEY"
